<Window x:Class="SpringBootLauncher.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:tb="http://www.hardcodet.net/taskbar"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Spring Boot Launcher"
        Width="900" Height="800"
        MinWidth="900" MinHeight="650"
        WindowStartupLocation="CenterScreen"
        Background="#E8EAED"
        ResizeMode="CanResize">

    <Window.Resources>
        <!-- 색상 팔레트 (진하게 조정) -->
        <SolidColorBrush x:Key="PrimaryBg" Color="#E8EAED"/>
        <SolidColorBrush x:Key="CardBg" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="HeaderText" Color="#000000"/>
        <SolidColorBrush x:Key="BodyText" Color="#1a1a1a"/>
        <SolidColorBrush x:Key="MutedText" Color="#5F6368"/>
        <SolidColorBrush x:Key="AccentGreen" Color="#0D9668"/>
        <SolidColorBrush x:Key="AccentRed" Color="#DC2626"/>
        <SolidColorBrush x:Key="AccentBlue" Color="#2563EB"/>
        <SolidColorBrush x:Key="AccentYellow" Color="#D97706"/>
        <SolidColorBrush x:Key="BorderColor" Color="#D1D5DB"/>
        
        <!-- 카드 스타일 -->
        <Style x:Key="ModernCard" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource CardBg}"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Margin" Value="12"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#000000" BlurRadius="12" ShadowDepth="2" Opacity="0.08" Direction="270" RenderingBias="Performance"/>
                </Setter.Value>
            </Setter>
            <!-- GPU 가속을 위한 비트맵 캐싱 (크기 변경 시 성능 향상) -->
            <Setter Property="CacheMode">
                <Setter.Value>
                    <BitmapCache EnableClearType="False" RenderAtScale="1" SnapsToDevicePixels="True"/>
                </Setter.Value>
            </Setter>
        </Style>
        
        
        <!-- 버튼 스타일 -->
        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource AccentBlue}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="20,12"/>
            <Setter Property="Margin" Value="6"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="8" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Opacity" Value="0.9"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Opacity" Value="0.5"/>
                    <Setter Property="Cursor" Value="Arrow"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <Style x:Key="SuccessButton" TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
            <Setter Property="Background" Value="{StaticResource AccentGreen}"/>
        </Style>
        
        <Style x:Key="DangerButton" TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
            <Setter Property="Background" Value="{StaticResource AccentRed}"/>
        </Style>
        
        <Style x:Key="WarningButton" TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
            <Setter Property="Background" Value="{StaticResource AccentYellow}"/>
        </Style>
        
        <Style x:Key="SecondaryButton" TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
            <Setter Property="Background" Value="#6B7280"/>
        </Style>
        
        <!-- 트레이 아이콘 -->
        <tb:TaskbarIcon x:Key="TrayIcon" x:Name="TrayIcon" Visibility="Visible"/>
        
    </Window.Resources>
    
    <Grid Background="{StaticResource PrimaryBg}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>   <!-- JAR 경로 -->
            <RowDefinition Height="Auto"/>   <!-- 상태 카드 -->
            <RowDefinition Height="*"/>      <!-- 로그 -->
            <RowDefinition Height="Auto"/>   <!-- 하단바 -->
        </Grid.RowDefinitions>

        <!-- JAR 파일 경로 선택 -->
        <Border Grid.Row="0" Style="{StaticResource ModernCard}" Margin="12,12,12,12">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0"
                               Text="JAR 파일 경로"
                               FontSize="16"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource HeaderText}"
                               VerticalAlignment="Center"
                               Margin="0,0,8,0"/>

                    <Border Grid.Column="1"
                            BorderBrush="{StaticResource BorderColor}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Background="White">
                        <TextBox x:Name="JarPathTextBox"
                                 BorderThickness="0"
                                 Padding="12,10"
                                 FontSize="14"
                                 VerticalContentAlignment="Center"
                                 ToolTip="JAR 파일 절대 경로"/>
                    </Border>

                    <Button x:Name="BrowseButton"
                            Grid.Column="2"
                            Content="📁 찾아보기"
                            Click="BrowseJar_Click"
                            Style="{StaticResource PrimaryButton}"
                            Margin="12,0,0,0"/>

                    <Button x:Name="SettingsButton"
                            Grid.Column="3"
                            Content="⚙️ 설정"
                            Click="Settings_Click"
                            Style="{StaticResource SecondaryButton}"
                            Margin="8,0,0,0"/>

                    
                </Grid>
            </Grid>
        </Border>
        
        <!-- 상태 & 가동시간 -->
        <Grid Grid.Row="1" Margin="12,0" Height="60">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- 서버 상태 -->
            <Border Grid.Column="0" Style="{StaticResource ModernCard}" Margin="0,0,6,0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
        
                    <TextBlock Grid.Column="0"
                               Text="서버 상태" 
                               FontSize="14" 
                               FontWeight="SemiBold" 
                               Foreground="{StaticResource MutedText}"
                               VerticalAlignment="Center"/>
        
                    <StackPanel Grid.Column="2" 
                                Orientation="Horizontal"
                                VerticalAlignment="Center">
                        <Ellipse x:Name="StatusIndicator" 
                                 Width="20" 
                                 Height="20" 
                                 Fill="{StaticResource AccentRed}" 
                                 Margin="0,0,12,0"/>
                        <TextBlock x:Name="StatusTextBlock" 
                                   Text="중지됨" 
                                   FontSize="15" 
                                   FontWeight="Bold" 
                                   Foreground="{StaticResource HeaderText}"/>
                    </StackPanel>
                </Grid>
            </Border>
            
            <!-- 가동 시간 -->
            <Border Grid.Column="1" Style="{StaticResource ModernCard}" Margin="6,0,0,0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
        
                    <TextBlock Grid.Column="0" 
                               Text="가동 시간" 
                               FontSize="14" 
                               FontWeight="SemiBold" 
                               Foreground="{StaticResource MutedText}"
                               VerticalAlignment="Center"/>
        
                    <TextBlock Grid.Column="2" 
                               x:Name="UptimeTextBlock" 
                               Text="00:00:00" 
                               FontSize="20" 
                               FontWeight="Bold" 
                               Foreground="{StaticResource HeaderText}"
                               VerticalAlignment="Center"/>
                </Grid>
            </Border>
        </Grid>
        
        <!-- 서버 제어 & 로그 -->
        <Border Grid.Row="2" Style="{StaticResource ModernCard}">
            <DockPanel>
                <!-- 제어 버튼 -->
                <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,20">
                    <Button x:Name="StartButton" 
                            Content="▶️ 시작" 
                            Click="StartButton_Click" 
                            Style="{StaticResource SuccessButton}"/>
                    <Button x:Name="StopButton" 
                            Content="⏹️ 중지" 
                            Click="StopButton_Click" 
                            Style="{StaticResource DangerButton}"/>
                    <Button x:Name="RestartButton" 
                            Content="🔄 재시작" 
                            Click="RestartButton_Click" 
                            Style="{StaticResource WarningButton}"/>
                    <Button x:Name="ClearLogButton" 
                            Content="🗑️ 로그 지우기" 
                            Click="ClearLogButton_Click" 
                            Style="{StaticResource SecondaryButton}"/>
                    <Button x:Name="ExportLogButton" 
                            Content="📤 Export" 
                            Click="ExportLogButton_Click" 
                            Style="{StaticResource PrimaryButton}"/>
                </StackPanel>
                
                <!-- 로그 영역 -->
                <DockPanel>
                    <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,0">
                    <TextBlock DockPanel.Dock="Top" 
                               Text="실시간 로그" 
                               FontSize="14" 
                               FontWeight="SemiBold" 
                               Foreground="{StaticResource MutedText}"
                               Margin="0,0,0,12"/>
                    <!-- 자동 시작 체크박스 -->
                    <CheckBox x:Name="AutoStartCheckBox"
                              Grid.Column="4"
                              Content="서버 자동 실행"
                              FontSize="13"
                              Foreground="{StaticResource BodyText}"
                              VerticalAlignment="Center"
                              Margin="20,0,0,10"
                              Checked="AutoStartCheckBox_Changed"
                              Unchecked="AutoStartCheckBox_Changed"/>
                    </StackPanel>
                    
                    <Border BorderBrush="{StaticResource BorderColor}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Background="#F9FAFB">
                        <ListBox x:Name="LogListBox"
                                 FontFamily="Consolas, Courier New"
                                 FontSize="12"
                                 BorderThickness="0"
                                 Background="Transparent"
                                 Foreground="{StaticResource BodyText}"
                                 SelectionMode="Extended"
                                 VirtualizingStackPanel.IsVirtualizing="True"
                                 VirtualizingStackPanel.VirtualizationMode="Recycling"
                                 VirtualizingStackPanel.CacheLength="20,20"
                                 VirtualizingStackPanel.CacheLengthUnit="Item"
                                 VirtualizingStackPanel.ScrollUnit="Pixel"
                                 ScrollViewer.IsDeferredScrollingEnabled="False"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                                 ScrollViewer.CanContentScroll="True"
                                 KeyDown="LogListBox_KeyDown">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}"
                                               TextWrapping="Wrap"
                                               TextTrimming="None"
                                               Padding="6,4"/>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="ListBoxItem">
                                    <Setter Property="Padding" Value="0"/>
                                    <Setter Property="Margin" Value="0"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="ListBoxItem">
                                                <Border Background="{TemplateBinding Background}"
                                                        Padding="{TemplateBinding Padding}">
                                                    <ContentPresenter HorizontalAlignment="Stretch" 
                                                                      VerticalAlignment="Top"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#F0F0F0"/>
                                        </Trigger>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter Property="Background" Value="#E0E7FF"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </ListBox.ItemContainerStyle>
                        </ListBox>
                    </Border>
                </DockPanel>
            </DockPanel>
        </Border>
        
        <!-- 하단 상태바 -->
        <Border Grid.Row="3" Background="White" Padding="24,16" BorderBrush="{StaticResource BorderColor}" BorderThickness="0,1,0,0">
            <Grid>
                <TextBlock x:Name="StatusBarText" 
                           Text="체크 주기: 5분 | 마지막 체크: -" 
                           Foreground="{StaticResource MutedText}"
                           FontSize="12"/>
                <TextBlock Text="💡 프로그램을 닫으면 작업표시줄에 배치" 
                           HorizontalAlignment="Right" 
                           Foreground="{StaticResource MutedText}"
                           FontSize="12"/>
            </Grid>
        </Border>
    </Grid>
</Window>
